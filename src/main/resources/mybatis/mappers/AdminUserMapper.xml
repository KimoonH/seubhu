<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="store.seub2hu2.admin.mapper.AdminMapper">

    <!--
        코스 등록폼에 들어갈 코스 시 / 구 / 동 조회
        List<Region> getRegions(@Param("condition") Map<String, Object> condition);
    -->
    <select id="getRegions">
        select
            region_no
            , region_si
            , region_gu
            , region_dong
        from
            COURSE_REGION
    </select>

    <!--
        코스등록
        void insertCourse(@Param("course") Course course);
        + 지역등록
        void insertRegion(@Param("region")Region region);
    -->
    <insert id="insertCourse">
        insert into COURSES
        (
         course_name
        , course_time
        , course_distance
        , course_level
        <if test="course.filename != null">
        , course_filename
        </if>
        )
        values
        (
        #{course.name}
        , #{course.time}
        , #{course.distance}
        , #{course.level}
        <if test="course.filename != null">
        , #{course.filename}
        </if>
        )
    </insert>

    <insert id="insertRegion" parameterType="store.seub2hu2.course.vo.Region">
        insert into COURSE_REGION
        (
        region_si
        , region_gu
        , region_dong
        )
        values
        (
         #{region.si}
         , #{region.gu}
         , #{region.dong}
        )
    </insert>
    <!--
        User getUserByNo(@Param("no") int no);
    -->
    <select id="getUserByNo" resultType="store.seub2hu2.user.vo.User">
        select
            user_no               as no
            , user_id               as id
            , user_name             as username
            , password
            , user_nickname         as nickname
            , user_tel              as tel
            , user_email            as email
            , user_created_date     as createdDate
            , user_type             as type
            , provider              as provider
        from
            USERS
        where
            user_no = #{no}
    </select>

    <!--
        int getTotalRows(@Param("condition") Map<String, Object> condition);
    -->
        <select id="getTotalRows" resultType="int">
            SELECT
                count(*) cnt
            FROM
                USERS
        </select>
    <!--
        List<User> getUsers(@Param("condition")Map<String, Object> condition);
    -->
    <select id="getUsers" resultType="store.seub2hu2.user.vo.User">
        select
            *
        from (
            select
             user_no               as no
            , user_id               as id
            , user_name             as username
            , password
            , user_nickname         as nickname
            , user_tel              as tel
            , user_email            as email
            , user_created_date     as createdDate
            , user_type             as type
            , provider              as provider
            , ROW_NUMBER() OVER (ORDER BY user_no desc) as rn
            from
                USERS
            <where>
                <if test="condition.opt != null">
                    <choose>
                        <when test="condition.opt == 'name'">
                             user_name like CONCAT('%',#{condition.value},'%')
                        </when>
                        <when test="condition.opt == 'id'">
                             user_id like CONCAT('%',#{condition.value},'%')
                        </when>
                        <when test="condition.opt == 'email'">
                             user_email like CONCAT('%',#{condition.value},'%')
                        </when>
                    </choose>
                </if>
            </where>
            ) as subquery
        where
            rn between #{condition.begin} and #{condition.end}
    </select>
</mapper>