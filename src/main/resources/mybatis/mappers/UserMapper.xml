<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.seub2hu2.user.mapper.UserMapper">

    <!-- 결과 맵 설정 -->
    <resultMap id="UserResultMap" type="store.seub2hu2.user.vo.User">
        <id property="no" column="USER_NO"/>
        <result property="id" column="USER_ID"/>
        <result property="username" column="USER_USERNAME"/>
        <result property="password" column="USER_PASSWORD"/>
        <result property="email" column="USER_EMAIL"/>
        <result property="nickname" column="USER_NICKNAME"/>
        <result property="type" column="USER_TYPE"/>
        <result property="provider" column="USER_PROVIDER"/>
        <result property="createdDate" column="USER_CREATED_DATE"/>
        <result property="updatedDate" column="USER_UPDATED_DATE"/>
        <result property="address" column="USER_ADDRESS"/>
    </resultMap>

    <!-- 사용자 이름으로 사용자 조회 -->
    <select id="getUserByUsername" resultMap="UserResultMap">
        select
            user_no as USER_NO,
            user_id as USER_ID,
            user_username as USER_USERNAME,
            user_password as USER_PASSWORD,
            user_email as USER_EMAIL,
            user_nickname as USER_NICKNAME,
            user_tel as USER_TEL,
            user_type as USER_TYPE,
            user_provider as USER_PROVIDER,
            user_created_date as USER_CREATED_DATE,
            user_updated_date as USER_UPDATED_DATE,
            user_address as USER_ADDRESS
        from
            users
        where
            user_username = #{username}
    </select>

    <!-- 사용자 번호로 역할 정보 조회 -->
    <select id="getRolesByUserNo" resultType="store.seub2hu2.user.vo.Role">
        select
            role_name as name,
            role_desc as description
        from
            role
        where
            role_name in (
                select role_name
                from user_granted_roles
                where user_no = #{no}
            )
    </select>

    <!-- 사용자 ID로 사용자 조회 -->
    <select id="findById" resultMap="UserResultMap">
        select
            user_no as USER_NO,
            user_id as USER_ID,
            user_username as USER_USERNAME,
            user_password as USER_PASSWORD,
            user_email as USER_EMAIL,
            user_nickname as USER_NICKNAME,
            user_type as USER_TYPE,
            user_provider as USER_PROVIDER,
            user_created_date as USER_CREATED_DATE,
            user_updated_date as USER_UPDATED_DATE,
            user_address as USER_ADDRESS
        from
            users
        where
            user_id = #{userId}
    </select>

    <!-- 사용자 정보 업데이트 -->
    <update id="updateUserInfo">
        update users
        set
            user_username = #{username},
            user_email = #{email},
            user_address = #{address}
        where
            user_id = #{userId}
    </update>

</mapper>
