<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store.seub2hu2.mypage.mapper.PostMapper">

    <!--
        Post getPostByNo(@Param("no") int no);
    -->

    <resultMap id="PostResultMap" type="store.seub2hu2.mypage.vo.Post">
        <!-- Post 객체의 필드 매핑 -->
        <id property="no" column="POST_NO"/> <!-- 게시글 번호 -->
        <result property="thumbnail" column="THUMBNAIL_IMAGE"/> <!-- 썸네일 -->
        <result property="postContent" column="POST_CONTEXT"/> <!-- 게시글 내용 -->
        <result property="postDeleted" column="POST_DELETED"/> <!-- 삭제 여부 -->
        <result property="postCreatedDate" column="CREATED_DATE"/> <!-- 작성 날짜 -->
        <!-- User 객체 매핑 -->
        <association property="user" javaType="store.seub2hu2.user.vo.User">
            <id property="no" column="USER_NO"/> <!-- 유저 번호 -->
            <result property="username" column="USER_NAME"/> <!-- 유저 이름 -->
        </association>
    </resultMap>


    <select id="getPostByNo" resultMap="PostResultMap">
        SELECT
            b.post_no,
            b.thumbnail_image,
            b.post_context,
            b.post_deleted,
            b.created_date,
            u.user_no ,
            u.user_name
        FROM
            POSTS b,
            USERS u
        WHERE
            b.user_no = u.user_no
          AND
            b.post_no = #{no}
    </select>

    <!-- void insertPost(@Param("post") Post post); -->

    <insert id="insertPost">
        insert into POSTS
        (THUMBNAIL_IMAGE, POST_CONTEXT, POST_DELETED, CREATED_DATE, USER_NO)
        VALUES
        (#{post.thumbnail, jdbcType=BLOB}, #{post.postContent}, #{post.postDeleted}, NOW(), 1)
    </insert>

    <!-- void insertPostImage(Map<String, Object> param); -->

    <insert id="insertPostImages" parameterType="list">
        INSERT INTO POST_IMAGES (IMAGE_URL, POST_NO)
        VALUES
        <foreach collection="list" item="image" separator=",">
            (#{image.imageUrl}, #{image.postNo})
        </foreach>
    </insert>


</mapper>